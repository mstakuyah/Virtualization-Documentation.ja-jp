---
title: Windows コンテナーネットワーク
description: ネットワーク ドライバーと Windows コンテナーのトポロジ。
keywords: Docker, コンテナー
author: jmesser81
ms.date: 03/27/2018
ms.topic: article
ms.prod: windows-containers
ms.service: windows-containers
ms.assetid: 538871ba-d02e-47d3-a3bf-25cda4a40965
ms.openlocfilehash: cd16f496b85c0977af0d40142768833acadea0f4
ms.sourcegitcommit: 6f505becbafb1e9785c67d6b0715c4c3af074116
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/05/2020
ms.locfileid: "78338046"
---
# <a name="windows-container-network-drivers"></a>Windows コンテナーネットワークドライバー  

Windows で Docker によって作成された既定の 'nat' ネットワークを活用することに加えて、ユーザーはカスタム コンテナー ネットワークを定義できます。 ユーザー定義ネットワークは、Docker CLI [`docker network create -d <NETWORK DRIVER TYPE> <NAME>`](https://docs.docker.com/engine/reference/commandline/network_create/)コマンドを使用して作成できます。 Windows では、次の種類のネットワーク ドライバーを利用できます。

- **nat**: 'nat' ドライバーを使用して作成されたネットワークに接続されているコンテナーは、*内部* Hyper-V スイッチに接続され、ユーザー指定 (``--subnet``) の IP プレフィックスから IP アドレスが割り当てられます。 コンテナー ホストからコンテナー エンドポイントへのポート フォワーディングおよびマッピングがサポートされています。
  
  >[!NOTE]
  > Windows Server 2019 (またはそれ以降) で作成された NAT ネットワークは、再起動後に保持されなくなります。

  > Windows 10 の作成者の更新プログラム (またはそれ以上) がインストールされている場合は、複数の NAT ネットワークがサポートされます。
  
- **transparent**: 'transparent' ドライバーを使用して作成されたネットワークに接続されているコンテナーは、*外部* Hyper-V スイッチを経由して物理ネットワークに直接接続されます。 物理ネットワークの IP は、静的に割り当てることも (ユーザー指定の ``--subnet`` オプションが必要)、外部の DHCP サーバーを使用して動的に割り当てることもできます。
  
  >[!NOTE]
  >次の要件により、Azure Vm では、透過ネットワーク経由でのコンテナーホストの接続はサポートされていません。
  
  > が必要: このモードが仮想化シナリオで使用されている場合 (コンテナーホストが VM の場合)、 _MAC アドレスのスプーフィングが必要_です。

- **overlay**: Docker エンジンが [swarm モード](../manage-containers/swarm-mode.md)で動作している場合、オーバーレイ ネットワークに接続されたコンテナーは、複数のコンテナー ホストの間で、同じネットワークに接続された他のコンテナーと通信できます。 Swarm クラスター上に作成される各オーバーレイ ネットワークは、プライベート IP プレフィックスによって定義される独自の IP サブネットを使って作成されます。 overlay ネットワーク ドライバーでは、VXLAN カプセル化が使用されます。 **適切なネットワーク制御プレーン (例: Flannel) を使用する場合は、Kubernetes と共に使用できます。**
  > 必要条件: オーバーレイネットワークを作成するために必要な[前提条件](https://docs.docker.com/network/overlay/#operations-for-all-overlay-networks)を環境が満たしていることを確認します。

  > が必要: Windows Server 2019 では、 [KB4489899](https://support.microsoft.com/help/4489899)が必要です。

  > が必要: Windows Server 2016 では、 [KB4015217](https://support.microsoft.com/help/4015217/windows-10-update-kb4015217)が必要です。

  >[!NOTE]
  >Windows Server 2019 では、Docker 群れによって作成されたオーバーレイネットワークは、送信接続用の VFP NAT ルールを活用します。 これは、特定のコンテナーが1つの IP アドレスを受け取ることを意味します。 また、`ping` や `Test-NetConnection` などの ICMP ベースのツールを、デバッグ状況での TCP/UDP オプションを使用して構成する必要があります。

- **l2bridge** -"l2bridge" ドライバーを使用して作成されたネットワークに接続されているコンテナーは、`transparent` ネットワークモードと同様に、*外部*hyper-v スイッチを介して物理ネットワークに接続されます。 L2bridge の違いは、受信と送信でのレイヤー2アドレス変換 (MAC の再書き込み) 操作によって、コンテナーエンドポイントがホストと同じ MAC アドレスを持つことです。 クラスタリングのシナリオでは、これにより、有効期間が短いコンテナーの MAC アドレスを学習する必要があるスイッチのストレスを軽減できます。 L2bridge ネットワークは、次の2つの異なる方法で構成できます。
  1. L2bridge ネットワークは、コンテナーホストと同じ IP サブネットを使用して構成されています
  2. L2bridge ネットワークが新しいカスタム IP サブネットで構成されています
  
  構成2では、ゲートウェイとして機能するホストネットワークコンパートメントにエンドポイントを追加し、指定されたプレフィックスのルーティング機能を構成する必要があります。 
  >[!TIP]
  >L2bridge を構成してインストールする方法の詳細については、[こちら](https://techcommunity.microsoft.com/t5/networking-blog/l2bridge-container-networking/ba-p/1180923)を参照してください。

- **l2tunnel** -l2bridge に似ています_が、このドライバーは Microsoft Cloud スタック (Azure) でのみ使用_してください。 コンテナーからのパケットは、SDN ポリシーが適用されている仮想化ホストに送信されます。


## <a name="network-topologies-and-ipam"></a>ネットワークトポロジと IPAM

次の表に、各ネットワーク ドライバーの内部 (コンテナー間) および外部接続で、ネットワーク接続がどのように提供されるかを示します。

### <a name="networking-modesdocker-drivers"></a>ネットワークモード/Docker ドライバー

  | Docker Windows ネットワーク ドライバー | 一般的な用途 | コンテナーからコンテナー (単一ノード) | コンテナーから外部 (単一ノード + マルチノード) | コンテナーとコンテナー間 (マルチノード) |
  |-------------------------------|:------------:|:------------------------------------:|:------------------------------------------------:|:-----------------------------------:|
  | **NAT (既定値)** | 開発者向け | <ul><li>同一サブネット: Hyper-V 仮想スイッチを介したブリッジ接続</li><li> クロスサブネット: サポートされていません (NAT 内部プレフィックスが1つのみ)</li></ul> | 管理 vNIC (WinNAT にバインド) を経由してルーティング | 直接サポート外: ホストを経由してポートを公開する必要があります |
  | **Transparent** | 開発者または小規模な開発向け | <ul><li>同一サブネット: Hyper-V 仮想スイッチを介したブリッジ接続</li><li>クロス サブネット: コンテナー ホストを経由してルーティング</li></ul> | (物理) ネットワーク アダプターへの直接アクセスでコンテナー ホストを経由してルーティング | (物理) ネットワーク アダプターへの直接アクセスでコンテナー ホストを経由してルーティング |
  | **オーバーレイ** | マルチノードに適しています。Kubernetes で利用可能な Docker の群れに必須 | <ul><li>同一サブネット: Hyper-V 仮想スイッチを介したブリッジ接続</li><li>クロス サブネット: ネットワーク トラフィックをカプセル化し、Mgmt vNIC を経由してルーティング</li></ul> | 直接サポートされない-windows server 2016 の NAT ネットワークまたは Windows Server 2019 の VFP NAT 規則に接続されている2番目のコンテナーエンドポイントが必要です。  | 同一/クロス サブネット: VXLAN を使用してネットワーク トラフィックをカプセル化し、Mgmt vNIC を経由してルーティング |
  | **L2Bridge** | Kubernetes および Microsoft SDN に使用 | <ul><li>同一サブネット: Hyper-V 仮想スイッチを介したブリッジ接続</li><li> クロス サブネット: コンテナーの MAC アドレスを入口と出口で書き換えてルーティング</li></ul> | コンテナーの MAC アドレスを入口と出口で書き換え | <ul><li>同一サブネット: ブリッジ接続</li><li>クロスサブネット: WSv1809 以上での管理 vNIC によるルーティング</li></ul> |
  | **L2Tunnel**| Azure のみ | 同一/クロス サブネット: ポリシーが適用される物理ホストの Hyper-V 仮想スイッチに折り返し | トラフィックは Azure の仮想ネットワーク ゲートウェイを経由する必要があります | 同一/クロス サブネット: ポリシーが適用される物理ホストの Hyper-V 仮想スイッチに折り返し |

### <a name="ipam"></a>IPAM

各ネットワーク ドライバーで、IP アドレスの割り当ては異なります。 Windows では、ホスト ネットワーク サービス (HNS) を使用して nat ドライバーに IPAM を提供し、Docker の Swarm モード (内部 KVS) と連携して overlay に IPAM を提供します。 その他のすべてのネットワーク ドライバーは、外部の IPAM を使用します。

| ネットワーク モード/ドライバー | IPAM |
| -------------------------|:----:|
| NAT | 内部 NAT サブネットプレフィックスからのホストネットワークサービス (HNS) による動的 IP の割り当てと割り当て |
| 透明 | コンテナー ホストのネットワーク プレフィックス内で IP アドレスから静的または動的 (外部 DHCP サーバーを使用して) IP 割り当て/設定 |
| オーバーレイ | Docker エンジン Swarm モードで管理されるプレフィックスからの動的 IP 割り当てと HNS による設定 |
| L2Bridge | コンテナーホストのネットワークプレフィックス内の IP アドレスからの静的 IP の割り当てと割り当て (または、HNS 経由で割り当てることもできます) |
| L2Tunnel | Azure のみ: プラグインから動的 IP 割り当て/設定 |

### <a name="service-discovery"></a>サービス検出

サービスの検出は、特定の Windows ネットワーク ドライバーについてのみサポートされます。

|  | ローカル サービス検出  | グローバル サービス検出 |
| :---: | :---------------     |  :---                |
| nat | 使用可能 | Docker EE で使用可能 |  
| overlay | 使用可能 | はい (Docker EE または kube) |
| 透明な | 使用不可 | 使用不可 |
| l2bridge | 使用不可 | はい (kube を使用) |
